---
import { getCollection } from "astro:content";
import Container from "@components/Container.astro";
import PageLayout from "@layouts/PageLayout.astro";
import ArrowCard from "@components/ArrowCard.astro";
import Link from "@components/Link.astro";
import { dateRange } from "@lib/utils";
import { SITE, HOME, SOCIALS } from "@consts";

const highlights = (await getCollection("highlights"))
  .filter(highlight => !highlight.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0,SITE.NUM_HIGHLIGHTS_ON_HOMEPAGE);

const work = (await getCollection("experience"))
  .filter(item => item.data.featured)
  .sort((a, b) => new Date(b.data.dateStart).valueOf() - new Date(a.data.dateStart).valueOf())
  .slice(0,SITE.NUM_EXPERIENCES_ON_HOMEPAGE);

// Person schema for structured data
const siteUrl = "https://alanmcginnis.com";
const personSchema = {
  "@context": "https://schema.org",
  "@type": "Person",
  name: SITE.NAME,
  email: SITE.EMAIL,
  url: siteUrl,
  image: `${siteUrl}/images/profile-200.webp`,
  jobTitle: "Technology Leader",
  description: HOME.DESCRIPTION,
  sameAs: SOCIALS.map(social => social.HREF),
};

// WebSite schema for structured data
const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  name: SITE.NAME,
  url: siteUrl,
  description: HOME.DESCRIPTION,
  publisher: {
    "@type": "Person",
    name: SITE.NAME,
  },
};

// Combine schemas for homepage
const homepageSchemas = [personSchema, websiteSchema];

---

<PageLayout title={HOME.TITLE} description={HOME.DESCRIPTION} structuredData={homepageSchemas}>
  <Container>
    <div class="animate mb-6">
      <img
        src="/images/profile-100.webp"
        srcset="
          /images/profile-100.webp 1x,
          /images/profile-200.webp 2x
        "
        alt="Alan McGinnis"
        width="100"
        height="100"
        class="w-[100px] h-[100px] rounded-xl object-cover shadow-md mb-4"
        loading="eager"
      />
      <h4 class="font-semibold text-black dark:text-white">
        Hi, I'm Alan McGinnis <span class="text-xl wave">üëãüèª</span> 
      </h4>
    </div>
    <div class="space-y-6 md:space-y-10">
      <section>
        <article class="space-y-4">
          <p class="animate">
            I help teams solve complex problems and drive measurable business results. Over the past decade, I've worked across technical implementation, client relationships, team leadership, and business development, always ensuring investments pay off. I think in outcomes, not outputs, and move fluidly between technical architecture, project execution, and business strategy.
          </p>
        </article>
      </section>

      <!-- Highlight section -->
      <section id="highlights" class="animate space-y-6">
        <div class="flex flex-wrap gap-y-2 items-center justify-between">
          <h5 class="font-semibold text-black dark:text-white">
            Highlights
          </h5>
          <article>
            <p>
              Project highlights showcasing different problems I've solved and the outcomes delivered.
            </p>
          </article>
        </div>
        <ul class="flex flex-col gap-4">
          {highlights.map(highlight => (
            <li>
              <ArrowCard entry={highlight} />
            </li>
          ))}
        </ul>
      </section>

      <!-- Work experience section -->
      <section id="experience" class="animate space-y-6">
        <div class="flex flex-wrap gap-y-2 items-center justify-between">
          <h5 class="font-semibold text-black dark:text-white">
            Recent Experience
          </h5>
          <Link href="/experience">
            See all
          </Link>
        </div>
        <ul class="flex flex-col space-y-6">
          {work.map(entry => (
            <li class="space-y-2">
              <div class="flex flex-col sm:flex-row sm:items-baseline sm:gap-3">
                <div class="text-lg font-semibold text-black dark:text-white">
                  {entry.data.company}
                </div>
                <div class="text-sm opacity-60">
                  {entry.data.featuredDate || dateRange(entry.data.dateStart, entry.data.dateEnd)}
                </div>
              </div>
              <div class="text-sm font-medium opacity-75">
                {entry.data.role}
              </div>
              {entry.data.blurb && (
                <p class="text-sm opacity-90 leading-relaxed">
                  {entry.data.blurb}
                </p>
              )}
            </li>
          ))}
        </ul>
      </section>

      <!-- Connect section -->
      <section id="connect" class="animate space-y-4">
        <h5 class="font-semibold text-black dark:text-white">
          Let's Connect
        </h5>
        <article>
          <p>
            Find me online. I'm always open to new opportunities and conversations.
          </p>
        </article>
        <ul class="flex flex-wrap gap-2">
          {SOCIALS.map(SOCIAL => (
            <li class="flex gap-x-2 text-nowrap">
              <Link href={SOCIAL.HREF} external aria-label={`${SITE.NAME} on ${SOCIAL.NAME}`}>
                {SOCIAL.NAME}
              </Link>
              {"/"}
            </li>
          ))}
          <li class="line-clamp-1">
            <Link href={`mailto:${SITE.EMAIL}`} aria-label={`Email ${SITE.NAME}`}>
              {SITE.EMAIL}
            </Link>
          </li>
        </ul>
      </section>
    </div>
  </Container>
</PageLayout>
